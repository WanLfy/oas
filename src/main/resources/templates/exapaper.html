<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta http-equiv="Content-Type" contents="text/html; charset=UTF-8"/>
    <link rel="stylesheet" href="css/bootstrap.css"/>
    <link rel="stylesheet" href="css/style.css"/>
    <script src="js/time.js"></script>
    <title>考试试卷</title>
</head>
<body style="overflow-y:scroll;position: relative;">

<div class="container-fluid">
    <div class="row">
        <div class="jumbotron col-md-12">
            <h2>在线考试系统</h2>
            <p>考试时间为60分钟</p>
            <div id="timer" style="color:red;float: right">距离考试结束还有<b>00</b>分<b>00</b>秒</div>
        </div>
    </div>

    <div class="row">
        <div class="col-sm-10 col-sm-offset-1" style="padding-top: 0px">
            <form action="/commitExaPaper" th:object="${answer}" method="post" class="form-group" id="userExaForm">
                <h3 id="typeTitle" style="margin-left: 2px;"
                    th:text="${ep.choiceList.size()!=0?'单选题':(ep.choicesList.size()!=0?'多选题':(ep.judgeList.size()!=0?'判断题':(ep.shortList.size()!=0?'简答题':'题目')))}"></h3>
                <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
                    <div class="alert alert-danger" role="alert" id="queDidNumMess"
                         style="display: none;margin:0 15px;padding: 10px;"></div>
                    <!-- 选择题 begin -->
                    <div class="panel-body" id="panelOne" th:if="${ep.choiceList.size()!=0}">
                        <div th:each="choice,c:${ep.choiceList}" th:id="'queDidNum'+${c.index}"
                             th:style="${c.index==0}?'':'display:none;'">
                            <!-- 题号 -->
                            <input type="hidden" th:value="${choice.queBank.queId}"
                                   th:name="${'choiceAnswer['+(c.index)+'].queId'}"/>
                            <input type="hidden" th:value="${tempId}"
                                   th:name="${'choiceAnswer['+(c.index)+'].tempId'}"/>
                            <input type="hidden" value="0"
                                   th:name="${'choiceAnswer['+(c.index)+'].type'}"/>
                            <div class="panel panel-default">
                                <div class="panel-heading"
                                     th:text="${((c.index)+1+'、')+(choice.queBank.title)}"></div>
                                <div class="panel-body">
                                        <textarea class="form-control"
                                                  th:if="${choice.queBank.des!=''}"
                                                  th:utext="${choice.queBank.des}"
                                                  style="background-color:#F5F5F5;"
                                                  readonly></textarea>
                                    <div th:if="${choice.queBank.qurl!=null}"
                                         th:style="${'width:400px;height:100px;background:url(img/'+(choice.queBank.qurl)+'.png) no-repeat;'}"></div>
                                    <ul class="list-group">
                                        <li class="list-group-item" th:each="options,o:${choice.queOptionsList}"
                                            th:if="${options.ourl==null}">
                                            <input type="radio"
                                                   th:name="${'choiceAnswer['+(c.index)+'].userAnswer'}"
                                                   th:text="'  '+${options.options}"
                                                   th:value="${options.options}"/>
                                        </li>
                                        <li class="list-group-item" th:each="options,o:${choice.queOptionsList}"
                                            th:if="${options.ourl!=null}">
                                            <input type="radio"
                                                   th:name="${'choiceAnswer['+(c.index)+'].userAnswer'}"
                                                   th:value="${options.options}">
                                            <div th:style="${'width:60px;height:60px;background:url(img/'+(options.ourl)+'.png) no-repeat;'}"></div>
                                            </input>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-1" style="text-align: center">
                                    <button type="button" class="btn btn-primary"
                                            th:onclick="'changeQuePre('+${c.index}+','+${ep.choiceList.size()}+','+${ep.choicesList.size()}+','+${ep.judgeList.size()}+','+${ep.shortList.size()}+')'">
                                        上一题
                                    </button>
                                </div>
                                <div class="col-sm-1" style="text-align: center">
                                    <button type="button" class="btn btn-primary"
                                            th:onclick="'changeQueNext('+${c.index}+','+${ep.choiceList.size()}+','+${ep.choicesList.size()}+','+${ep.judgeList.size()}+','+${ep.shortList.size()}+')'">
                                        下一题
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- 选择题 end -->

                    <!-- 多选题 begin -->
                    <div class="panel-body" id="panelTwo" th:if="${ep.choicesList.size()!=0}">
                        <div th:each="choices,c:${ep.choicesList}"
                             th:id="'queDidNum'+${ep.choiceList.size()+(c.index)}"
                             th:style="${(ep.choiceList.size()+c.index)==0}?'':'display:none;'">
                            <!-- 题号 -->
                            <input type="hidden" th:value="${choices.queBank.queId}"
                                   th:name="${'choicesAnswer['+(c.index)+'].queId'}"/>
                            <input type="hidden" th:value="${tempId}"
                                   th:name="${'choicesAnswer['+(c.index)+'].tempId'}"/>
                            <input type="hidden" value="3"
                                   th:name="${'choicesAnswer['+(c.index)+'].type'}"/>
                            <div class="panel panel-default">
                                <div class="panel-heading"
                                     th:text="${((c.index)+1+'、')+(choices.queBank.title)}"></div>
                                <div class="panel-body">
                                          <textarea class="form-control"
                                                    th:if="${choices.queBank.des!=''}"
                                                    th:utext="${choices.queBank.des}"
                                                    style="background-color:#F5F5F5;"
                                                    readonly></textarea>
                                    <ul class="list-group">
                                        <li class="list-group-item"
                                            th:each="options,o:${choices.queOptionsList}">
                                            <input type="checkbox"
                                                   th:name="${'choicesAnswer['+(c.index)+'].answerList['+(o.index)+']'}"
                                                   th:text="'  '+${options.options}"
                                                   th:value="${options.options}"/>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            <div>
                                <div class="col-sm-1" style="text-align: center">
                                    <button type="button" class="btn btn-primary"
                                            th:onclick="'changeQuePre('+${ep.choiceList.size()+(c.index)}+','+${ep.choiceList.size()}+','+${ep.choicesList.size()}+','+${ep.judgeList.size()}+','+${ep.shortList.size()}+')'">
                                        上一题
                                    </button>
                                </div>
                                <div class="col-sm-1" style="text-align: center">
                                    <button type="button" class="btn btn-primary"
                                            th:onclick="'changeQueNext('+${ep.choiceList.size()+(c.index)}+','+${ep.choiceList.size()}+','+${ep.choicesList.size()}+','+${ep.judgeList.size()}+','+${ep.shortList.size()}+')'">
                                        下一题
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- 多选题 end-->

                    <!-- 判断题 begin -->
                    <div class="panel-body" id="panelThree" th:if="${ep.judgeList.size()!=0}">
                        <div th:each="judge,j:${ep.judgeList}"
                             th:id="'queDidNum'+${ep.choiceList.size()+ep.choicesList.size()+(j.index)}"
                             th:style="${(ep.choiceList.size()+ep.choicesList.size()+j.index)==0}?'':'display:none;'">
                            <input type="hidden" th:value="${judge.queId}"
                                   th:name="${'judgeAnswer['+(j.index)+'].queId'}"/>
                            <input type="hidden" th:value="${tempId}"
                                   th:name="${'judgeAnswer['+(j.index)+'].tempId'}"/>
                            <input type="hidden" value="1"
                                   th:name="${'judgeAnswer['+(j.index)+'].type'}"/>
                            <div class="panel panel-default">
                                <div class="panel-heading" th:text="${((j.index)+1+'、')+(judge.title)}"></div>
                                <div class="panel-body">
                    <textarea class="form-control"
                              th:if="${judge.des!=''}"
                              th:utext="${judge.des}"
                              style="background-color:#F5F5F5;"
                              readonly></textarea>
                                    <ul class="list-group">
                                        <li class="list-group-item">
                                            <input type="radio"
                                                   th:name="${'judgeAnswer['+(j.index)+'].userAnswer'}"
                                                   value="1"/> 正确
                                        </li>
                                        <li class="list-group-item">
                                            <input type="radio"
                                                   th:name="${'judgeAnswer['+(j.index)+'].userAnswer'}"
                                                   value="0"/> 错误
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            <div>
                                <div class="col-sm-1" style="text-align: center">
                                    <button type="button" class="btn btn-primary"
                                            th:onclick="'changeQuePre('+${ep.choiceList.size()+ep.choicesList.size()+(j.index)}+','+${ep.choiceList.size()}+','+${ep.choicesList.size()}+','+${ep.judgeList.size()}+','+${ep.shortList.size()}+')'">
                                        上一题
                                    </button>
                                </div>
                                <div class="col-sm-1" style="text-align: center">
                                    <button type="button" class="btn btn-primary"
                                            th:onclick="'changeQueNext('+${ep.choiceList.size()+ep.choicesList.size()+(j.index)}+','+${ep.choiceList.size()}+','+${ep.choicesList.size()}+','+${ep.judgeList.size()}+','+${ep.shortList.size()}+')'">
                                        下一题
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- 判断题 end -->

                    <!-- 简答题 begin-->
                    <div class="panel-body" id="panelFour" th:if="${ep.shortList.size()!=0}">
                        <div th:each="shortt,s:${ep.shortList}"
                             th:value="${(ep.choiceList.size()+ep.choicesList.size()+ep.judgeList.size()+s.index)}"
                             th:id="'queDidNum'+${ep.choiceList.size()+ep.choicesList.size()+ep.judgeList.size()+(s.index)}"
                             th:style="${(ep.choiceList.size()+ep.choicesList.size()+ep.judgeList.size()+s.index)==0}?'':'display:none;'">
                            <input type="hidden" th:value="${shortt.queId}"
                                   th:name="${'shortAnswer['+(s.index)+'].queId'}"/>
                            <input type="hidden" th:value="${tempId}"
                                   th:name="${'shortAnswer['+(s.index)+'].tempId'}"/>
                            <input type="hidden" value="2"
                                   th:name="${'shortAnswer['+(s.index)+'].type'}"/>
                            <div class="panel panel-default">
                                <div class="panel-heading" th:text="${((s.index)+1+'、')+(shortt.title)}"></div>
                                <div class="panel-body">
                    <textarea class="form-control"
                              th:if="${shortt.des!=''}"
                              th:utext="${shortt.des}"
                              style="background-color:#F5F5F5;"
                              readonly></textarea>
                                    <textarea class="form-control"
                                              th:name="${'shortAnswer['+(s.index)+'].userAnswer'}"></textarea>
                                </div>
                            </div>
                            <div>
                                <div class="col-sm-1" style="text-align: center">
                                    <button type="button" class="btn btn-primary"
                                            th:onclick="'changeQuePre('+${ep.choiceList.size()+ep.choicesList.size()+ep.judgeList.size()+(s.index)}+','+${ep.choiceList.size()}+','+${ep.choicesList.size()}+','+${ep.judgeList.size()}+','+${ep.shortList.size()}+')'">
                                        上一题
                                    </button>
                                </div>
                                <div class="col-sm-1" style="text-align: center">
                                    <button type="button" class="btn btn-primary" title="Dismissible popover"
                                            data-content="And here's some amazing content. It's very engaging. Right?"
                                            th:onclick="'changeQueNext('+${ep.choiceList.size()+ep.choicesList.size()+ep.judgeList.size()+(s.index)}+','+${ep.choiceList.size()}+','+${ep.choicesList.size()}+','+${ep.judgeList.size()}+','+${ep.shortList.size()}+')'">
                                        下一题
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!--简答题 end -->
                </div>
            </form>
            <div class="col-sm-1 col-sm-offset-11" style="text-align: center;">
                <button class="btn btn-primary" id="subBtn" disabled>提交试卷</button>
            </div>
        </div>
        <div style="margin-left:2px;color: #fff;background-color: #337ab7;border-color: #2e6da4;line-height:20px;width: 100px;height:40px;border-radius:0 5px 5px 0 "
             id="myAffix">
            距离考试结束还有<b>00</b>分<b>00</b>秒
        </div>
    </div>
</div>
<script src="js/jquery.js"></script>
<script src="js/bootstrap.js"></script>
<script src="js/common.js"></script>
<script src="js/jquery.flexText.js"></script>
<script type="text/javascript" language="JavaScript">
    $(document).ready(function () {
        $("textarea").flexText();
        var flag = getCookie("FLAG");
        if (flag) {
            $("#subBtn").removeAttr("disabled");
        }
    });
    $("#subBtn").click(function () {
        var wc = window.confirm("确定要提交试卷吗？");
        if (wc == true) {
            delCookie("FLAG");
            $("#userExaForm").submit();
            $('#userExaForm').hide()
        } else {
            return false;
        }
    });
    /* 左侧固定显示倒计时*/
    $('#myAffix').affix({
        offset: {
            top: function () {
                return (this.top =
                    $('.bs-top').outerHeight(true))
            }, bottom: function () {
                return (this.bottom =
                    $('.bs-footer').outerHeight(true))
            }
        }
    })

    function changeQueNext(num, oneNum, twoNum, threeNum, fourNum) {
        if ($('#queDidNum' + (num + 1)).length > 0) {
            $('#queDidNumMess').text('');
            $('#queDidNumMess').css('display', 'none');
            if ((num + 1) < oneNum) {
                $('#typeTitle').text('单选题');
                $('#panelOne').show();
                $('#panelTwo').hide();
                $('#panelThree').hide();
                $('#panelFour').hide();
            } else if (oneNum <= (num + 1) && (num + 1) < (oneNum + twoNum)) {
                $('#typeTitle').text('多选题');
                $('#panelOne').hide();
                $('#panelTwo').show();
                $('#panelThree').hide();
                $('#panelFour').hide();
            } else if ((oneNum + twoNum) <= (num + 1) && (num + 1) < (oneNum + twoNum + threeNum)) {
                $('#typeTitle').text('判断题');
                $('#panelOne').hide();
                $('#panelTwo').hide();
                $('#panelThree').show();
                $('#panelFour').hide();
            } else if ((oneNum + twoNum + threeNum) <= (num + 1) && (num + 1) < (oneNum + twoNum + threeNum + fourNum)) {
                $('#typeTitle').text('简答题');
                $('#panelOne').hide();
                $('#panelTwo').hide();
                $('#panelThree').hide();
                $('#panelFour').show();
            }

            $('#queDidNum' + num).hide();
            $('#queDidNum' + (num + 1)).show();
        } else {
            $('#queDidNumMess').text('已经是最后一题');
            $('#queDidNumMess').css('display', 'block');
        }
    }

    function changeQuePre(num, oneNum, twoNum, threeNum, fourNum) {
        if ($('#queDidNum' + (num - 1)).length > 0) {
            $('#queDidNumMess').text('');
            $('#queDidNumMess').css('display', 'none');
            if ((num - 1) < oneNum) {
                $('#typeTitle').text('单选题');
                $('#panelOne').show();
                $('#panelTwo').hide();
                $('#panelThree').hide();
                $('#panelFour').hide();
            } else if (oneNum <= (num - 1) && (num - 1) < (oneNum + twoNum)) {
                $('#typeTitle').text('多选题');
                $('#panelOne').hide();
                $('#panelTwo').show();
                $('#panelThree').hide();
                $('#panelFour').hide();
            } else if ((oneNum + twoNum) <= (num - 1) && (num - 1) < (oneNum + twoNum + threeNum)) {
                $('#typeTitle').text('判断题');
                $('#panelOne').hide();
                $('#panelTwo').hide();
                $('#panelThree').show();
                $('#panelFour').hide();
            } else if ((oneNum + twoNum + threeNum) <= (num - 1) && (num - 1) < (oneNum + twoNum + threeNum + fourNum)) {
                $('#typeTitle').text('简答题');
                $('#panelOne').hide();
                $('#panelTwo').hide();
                $('#panelThree').hide();
                $('#panelFour').show();
            }
            $('#queDidNum' + num).hide();
            $('#queDidNum' + (num - 1)).show();
        } else {
            $('#queDidNumMess').text('已经是第一题');
            $('#queDidNumMess').css('display', 'block');
        }
    }
</script>
</body>
</html>